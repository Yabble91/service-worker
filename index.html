<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			.boxImg {
				width: 400px;
				height: 400px;
			}
		</style>
		<link rel="stylesheet" href="./main.css">
		<script type="text/javascript" src="./JQuery3.2.1.js"></script>
	</head>
	<body>
		<div id="" class="box1">
			<img class="boxImg" src="./main.jpg"/>
			<p id="cur_txt">当前注册状态：<span id="cur_status"></span></p>
			<p id="sw_txt">当前sw状态：<span id="sw_status"></span></p>
			<button type="button" name="button" id="btn1">点击获取图片fetch</button>
			<button type="button" name="button" id="btn2">点击获取图片ajax</button>
			<button type="button" name="button" id="btn3">点击访问接口ajax</button>
		</div>
		<script type="text/javascript">
			var curTxt = document.querySelector('#cur_txt');
			var curStatus = document.querySelector('#cur_status');
			var swTxt = document.querySelector('#sw_txt');
			var swStatus = document.querySelector('#sw_status');
			var btn1 = document.querySelector('#btn1');
			var btn2 = document.querySelector('#btn2');
			var btn3 = document.querySelector('#btn3');
			if ('serviceWorker' in navigator) {
//				navigator.serviceWorker.register
				navigator.serviceWorker.register('./serviceWorkerStore.js').then(function (reg){
					var serviceWorkder;
					if (reg.installing) {
						serviceWorkder = reg.installing
						curStatus.innerText = '安装中'
					} else if (reg.waiting) {
						serviceWorkder = reg.waiting
						curStatus.innerText = '等待中'
					} else if (reg.active) {
						serviceWorkder = reg.active
						curStatus.innerText = '已激活'
					}
					if (serviceWorkder) {
						swStatus.innerText = serviceWorkder.state;
						serviceWorkder.addEventListener('statechange', function (e) {
							console.log('sw状态变化为', e.target.state);
						})
					}
				}).catch(function(err) {
					console.log(err)
				})
			}

			// 点击按钮1发起fetch请求
			btn1.onclick = () => {
				fetch('./cry.jpg').then(res => {
					console.log('fetch :', res)
				})
			}

			// 点击按钮2发起ajax请求
			btn2.onclick = () => {
				$.get('./cry.jpg', function (res) {
					console.log(res)
				})
			}

			// 点击按钮3发起ajax请求
			btn2.onclick = () => {
				$.get('http://car.ctrip.com//json/mark?callback=jQuery111205901231933568096_1546528769406&_=1546528769407', function (res) {
					console.log('ajax :', res)
				})
			}
		</script>
		<script type="text/javascript" src="./main.js"></script>
	</body>
</html>
